SET(APP_NAME srf-ip-conn-srv)

SET(JSMN_PATH $ENV{JSMN_PATH})
SET(SRF_IP_CONN_PATH $ENV{SRF_IP_CONN_PATH})

SET(SRC_DIR "../srf-ip-conn-srv")

########################################################################

INCLUDE(CMakeForceCompiler)

list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}")
include(GetGitRevisionDescription)
get_git_head_revision(GIT_REFSPEC GIT_SHA1)
STRING(SUBSTRING ${GIT_SHA1} 0 7 GIT_SHA1_7CHARS)
STRING(TOUPPER ${GIT_SHA1_7CHARS} GIT_SHA1_7CHARS)
CONFIGURE_FILE("${SRC_DIR}/githash.h.in" "${SRC_DIR}/githash.h" @ONLY)

IF(NOT CMAKE_BUILD_TYPE MATCHES Debug)
    SET (CMAKE_BUILD_TYPE Release)
ENDIF()

IF(CMAKE_BUILD_TYPE MATCHES Release)
    SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/release)
    SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/release)
ELSEIF(CMAKE_BUILD_TYPE MATCHES Debug)
    SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/debug)
    SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/debug)
ENDIF()

MESSAGE(STATUS "BUILD_TYPE: " ${CMAKE_BUILD_TYPE})

SET(CMAKE_SYSTEM_NAME Generic)
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)

SET(CMAKE_STATIC_LIBRARY_PREFIX)
SET(CMAKE_STATIC_LIBRARY_SUFFIX)

SET(CMAKE_EXECUTABLE_LIBRARY_PREFIX)
SET(CMAKE_EXECUTABLE_LIBRARY_SUFFIX)

SET(EXECUTABLE_OUTPUT_PATH ${CMAKE_BUILD_TYPE})

# Common C compiler flags
SET(CMAKE_C_FLAGS "")
SET(CMAKE_C_FLAGS_DEBUG "")
SET(CMAKE_C_FLAGS_RELEASE "")
SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall")
SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wno-strict-aliasing")
SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=gnu99")
SET(CMAKE_C_FLAGS_DEBUG "${CMAKE_C_FLAGS_DEBUG} -Og -g2 -DDEBUG=1")
SET(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} -O4 -DNDEBUG=1")

# Linker flags
SET(CMAKE_EXE_LINKER_FLAGS "")
SET(CMAKE_EXE_LINKER_FLAGS_DEBUG "")
SET(CMAKE_EXE_LINKER_FLAGS_RELEASE "")

INCLUDE_DIRECTORIES("${SRC_DIR}")
INCLUDE_DIRECTORIES("${JSMN_PATH}")
INCLUDE_DIRECTORIES("${SRF_IP_CONN_PATH}")

SET(LIBRARY_OUTPUT_PATH ${EXECUTABLE_OUTPUT_PATH})

ADD_EXECUTABLE(	${APP_NAME}
	${SRF_IP_CONN_PATH}/srf-ip-conn/common/sha2.h
	${SRF_IP_CONN_PATH}/srf-ip-conn/common/sha2.c
	${SRF_IP_CONN_PATH}/srf-ip-conn/common/srf-ip-conn-packet.h
	${SRF_IP_CONN_PATH}/srf-ip-conn/common/srf-ip-conn-packet.c
	${JSMN_PATH}/jsmn.h
	${JSMN_PATH}/jsmn.c
	${SRC_DIR}/main.c
	${SRC_DIR}/types.h
	${SRC_DIR}/config.h
	${SRC_DIR}/config.c
	${SRC_DIR}/server-sock.h
	${SRC_DIR}/server-sock.c
	${SRC_DIR}/sock.h
	${SRC_DIR}/sock.c
	${SRC_DIR}/json.h
	${SRC_DIR}/json.c
	${SRC_DIR}/packet.h
	${SRC_DIR}/packet.c
	${SRC_DIR}/client.h
	${SRC_DIR}/client.c
	${SRC_DIR}/api.h
	${SRC_DIR}/api.c
	${SRC_DIR}/githash.h
)
